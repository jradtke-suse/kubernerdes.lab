global
    log /dev/log local0
    log /dev/log local1 notice
    chroot /var/lib/haproxy
    stats socket /var/lib/haproxy/stats user haproxy group haproxy mode 0640 level operator
    stats timeout 30s
    user haproxy
    group haproxy
    daemon
    maxconn 4000

    # Default SSL material locations
    ca-base /etc/ssl/certs
    crt-base /etc/ssl/private

    # Intermediate configuration
    ssl-default-bind-ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384
    ssl-default-bind-options ssl-min-ver TLSv1.2 no-tls-tickets

defaults
    log     global
    mode    tcp
    option  tcplog
    option  dontlognull
    timeout connect 5000
    timeout client  50000
    timeout server  50000
    retries 3

#---------------------------------------------------------------------
# Statistics
#---------------------------------------------------------------------
listen stats
    bind *:9000
    mode http
    stats enable
    stats uri /stats
    stats refresh 10s
    stats auth admin:rancher

#---------------------------------------------------------------------
# Rancher Cluster (10.10.12.210)
#---------------------------------------------------------------------
frontend rancher-http
    bind 10.10.12.210:80
    mode tcp
    default_backend rancher-http-backend

backend rancher-http-backend
    mode tcp
    balance roundrobin
    option tcp-check
    server rancher-01 10.10.12.211:80 check fall 3 rise 2
    server rancher-02 10.10.12.212:80 check fall 3 rise 2
    server rancher-03 10.10.12.213:80 check fall 3 rise 2

frontend rancher-https
    bind 10.10.12.210:443
    mode tcp
    default_backend rancher-https-backend

backend rancher-https-backend
    mode tcp
    balance roundrobin
    option tcp-check
    server rancher-01 10.10.12.211:443 check fall 3 rise 2
    server rancher-02 10.10.12.212:443 check fall 3 rise 2
    server rancher-03 10.10.12.213:443 check fall 3 rise 2

frontend rancher-k8s-api
    bind 10.10.12.210:6443
    mode tcp
    default_backend rancher-k8s-api-backend

backend rancher-k8s-api-backend
    mode tcp
    balance roundrobin
    option tcp-check
    server rancher-01 10.10.12.211:6443 check fall 3 rise 2
    server rancher-02 10.10.12.212:6443 check fall 3 rise 2
    server rancher-03 10.10.12.213:6443 check fall 3 rise 2

#---------------------------------------------------------------------
# Observability Cluster (10.10.12.220)
#---------------------------------------------------------------------
frontend observability-http
    bind 10.10.12.220:80
    mode tcp
    default_backend observability-http-backend

backend observability-http-backend
    mode tcp
    balance roundrobin
    option tcp-check
    server observability-01 10.10.12.221:80 check fall 3 rise 2
    server observability-02 10.10.12.222:80 check fall 3 rise 2
    server observability-03 10.10.12.223:80 check fall 3 rise 2

frontend observability-https
    bind 10.10.12.220:443
    mode tcp
    default_backend observability-https-backend

backend observability-https-backend
    mode tcp
    balance roundrobin
    option tcp-check
    server observability-01 10.10.12.221:443 check fall 3 rise 2
    server observability-02 10.10.12.222:443 check fall 3 rise 2
    server observability-03 10.10.12.223:443 check fall 3 rise 2

frontend observability-k8s-api
    bind 10.10.12.220:6443
    mode tcp
    default_backend observability-k8s-api-backend

backend observability-k8s-api-backend
    mode tcp
    balance roundrobin
    option tcp-check
    server observability-01 10.10.12.221:6443 check fall 3 rise 2
    server observability-02 10.10.12.222:6443 check fall 3 rise 2
    server observability-03 10.10.12.223:6443 check fall 3 rise 2

#---------------------------------------------------------------------
# RKE2-Harv-DC-01 Cluster (10.10.12.230)
#---------------------------------------------------------------------
frontend rke2-harv-dc-01-http
    bind 10.10.12.230:80
    mode tcp
    default_backend rke2-harv-dc-01-http-backend

backend rke2-harv-dc-01-http-backend
    mode tcp
    balance roundrobin
    option tcp-check
    server rke2-harv-dc01-01 10.10.12.231:80 check fall 3 rise 2
    server rke2-harv-dc01-02 10.10.12.232:80 check fall 3 rise 2
    server rke2-harv-dc01-03 10.10.12.233:80 check fall 3 rise 2

frontend rke2-harv-dc-01-https
    bind 10.10.12.230:443
    mode tcp
    default_backend rke2-harv-dc-01-https-backend

backend rke2-harv-dc-01-https-backend
    mode tcp
    balance roundrobin
    option tcp-check
    server rke2-harv-dc01-01 10.10.12.231:443 check fall 3 rise 2
    server rke2-harv-dc01-02 10.10.12.232:443 check fall 3 rise 2
    server rke2-harv-dc01-03 10.10.12.233:443 check fall 3 rise 2

frontend rke2-harv-dc-01-k8s-api
    bind 10.10.12.230:6443
    mode tcp
    default_backend rke2-harv-dc-01-k8s-api-backend

backend rke2-harv-dc-01-k8s-api-backend
    mode tcp
    balance roundrobin
    option tcp-check
    server rke2-harv-dc01-01 10.10.12.231:6443 check fall 3 rise 2
    server rke2-harv-dc01-02 10.10.12.232:6443 check fall 3 rise 2
    server rke2-harv-dc01-03 10.10.12.233:6443 check fall 3 rise 2

frontend rke2-harv-dc-01-8443
    bind 10.10.12.230:8443
    mode tcp
    default_backend rke2-harv-dc-01-8443-backend

backend rke2-harv-dc-01-8443-backend
    mode tcp
    balance roundrobin
    option tcp-check
    server rke2-harv-dc01-01 10.10.12.231:8443 check fall 3 rise 2
    server rke2-harv-dc01-02 10.10.12.232:8443 check fall 3 rise 2
    server rke2-harv-dc01-03 10.10.12.233:8443 check fall 3 rise 2
